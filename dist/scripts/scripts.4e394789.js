"use strict";angular.module("tatchaApp",["ngAnimate","ngTouch","ui.router","ngStorage"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",resolve:{products:["catalogueService","catalogueFactory",function(a,b){return a.products||b.fetchAll()}]},templateUrl:"views/home.html",controller:"CatalogueController",controllerAs:"ctlg"})}]),angular.module("tatchaApp").controller("CatalogueController",["catalogueService",function(a){function b(){k>=l+1?l++:l=0,f(),e()}function c(){l-1>=0?l--:l=i.length-1,f(),e()}function d(a){"25"===a&&(g.product.image_url="http://i.imgur.com/n4bDW1u.png")}function e(){var a=/(<a.*?>)|(<\/?\w+ ?\/?>|(&nbsp;))/g,b=/:/g;g.product.short_description=g.product.short_description.replace(a,""),g.product.description=g.product.description.replace(a,""),g.product.short_description=g.product.short_description.replace(b,": "),g.product.description=g.product.description.replace(b,": ")}function f(){j=i[l],g.product=h[j],d(g.product.entity_id)}var g=this;g.toggleDesc=!0;var h=a.products,i=Object.keys(h),j=i[0],k=i.length-1,l=0;g.product=h[j],e(),g.nextProduct=b,g.prevProduct=c}]),angular.module("tatchaApp").factory("catalogueFactory",["$http","$q","catalogueService",function(a,b,c){function d(){var d=b.defer();return a.get("http://api.tatcha.com/shop/api/rest/products").success(function(a){d.resolve(a),c.products=a}).error(function(a){d.reject(a)}),d.promise}return{fetchAll:d}}]),angular.module("tatchaApp").factory("catalogueService",["$localStorage",function(){return{}}]),angular.module("tatchaApp").directive("product",[function(){return{restrict:"E",controller:"CatalogueController",controllerAs:"ctlg",scope:{image_url:"=image",name:"=name",short_description:"=summary",description:"=description"},bindToController:!0,templateUrl:"views/product.html",link:function(a,b,c,d){b.find("#next").on("click",function(){d.nextProduct(),a.$apply()}),b.find("#prev").on("click",function(){d.prevProduct(),a.$apply()})}}}]);